<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>Photographer</title>

		<style>
			.carousel__item {
				display: none;
			}

			.carousel__item-visible {
				display: block;
			}
		</style>

		<script>
			const registerServiceWorker = async () => {
				if ("serviceWorker" in navigator) {
					try {
						const registration = await navigator.serviceWorker.register("/sw.js", {
							scope: "/",
						});

						if (registration.installing) {
							console.log("Service worker installing");
						} else if (registration.waiting) {
							console.log("Service worker installed");
						} else if (registration.active) {
							console.log("Service worker active");
						}

					} catch (error) {
						console.error(`Registration failed with ${error}`);
					}
				}
			};

			//registerServiceWorker();
		</script>

		<script type="application/json" id="data">
			{{ &json }}
		</script>
	</head>

	<body>
		<span id="title"></span>
		<div id="carousel"></div>

		<script type="text/javascript">
			(() => {
				const data = JSON.parse(document.getElementById("data").innerHTML);

				const photos = data.photos.filter(photo => photo.albums.includes("main"));
				const album = data.albums.main;

				const carousel = document.querySelector("#carousel");

				const loadImage = (img, url, thumbnail) => {
					img.src = thumbnail;

					const tmpImg = document.createElement("img");

					tmpImg.src = url;

					console.log(tmpImg);

					tmpImg.onload = () => {
						img.src = tmpImg.src;
					};
				};

				const carouselImgs = Array(3).fill(true).map(() => {
					const img = document.createElement("img");

					img.classList.add("carousel__item");
					img.alt = photos[0].name;
					img.width = 160 * 3;
					img.height = 90 * 3;

					loadImage(img, photos[0].path, photos[0].thumbnail);

					return img;
				});

				carouselImgs.forEach(img => carousel.append(img));

				carouselImgs[1].classList.add("carousel__item-visible");

				document.querySelector("#title").innerText = album.title;
			})();
		</script>
	</body>
</html>


